$(document).ready(function () {
  isTab = false;
  if (window.innerWidth < 1025) {
    isTab = true;
  } else {
  }

  isMobile = false;
  if (window.innerWidth < 577) {
    isMobile = true;
  }

  hideScroll = () => {};

  currentPage = "1";
  currentCover = 1;
  // changePage = (derection) => {
  //   if (derection == "up") {
  //     if (currentPage == "1") {
  //       return;
  //     }
  //   } else if (derection == "down") {
  //     // if (derection == "p-1") {
  //     //   return;
  //     // }
  //     currentActivePage = document.querySelector(".active-page");
  //     currentIndex = Number(currentActivePage.getAttribute("pageIndex")) + 1;
  //     currentActivePage.classList.remove("active-page");
  //     console.log(currentActivePage);
  //     var selector = '[pageIndex="' + currentIndex + '"]';
  //     targetPage = document.querySelector(selector);
  //     if (targetPage) {
  //       targetPage.classList.add("active-page");
  //     }
  //   }
  // };

  isPlayVideoVne = false;

  changePage = (elementTarget) => {
    currentPage = document.querySelector(".active-page");
    index = elementTarget.getAttribute("value");

    //Check khi từ tab 2 đi và video đang bật thì mới pause nếu ko bị lỗi
    if (index == 2) {
      if (isPlayVideoVne) {
        // Video.vodIns[394440].pause()
      }
    }

    //Đổi nút
    document.querySelector(".active-nav").classList.remove("active-nav");
    elementTarget.classList.add("active-nav");
    //Đổi trang

    var selector = '[index="' + index + '"]';
    targetPage = document.querySelector(selector);
    if (targetPage == currentPage) {
      return;
    } else {
      currentPage.classList.remove("active-page");
    }

    targetPage.classList.add("active-page");
    resetAos();
  };

  resetAos = () => {
    console.log("reset AOS");
    elementHasRefrestAos = document.querySelectorAll(".aos-animate");
    elementHasRefrestAos.forEach((aos) => {
      aos.classList.remove("aos-animate");
    });

    setTimeout(() => {
      AOS.init();
      AOS.refreshHard();
    }, 300);
  };

  isbottom = false;
  changeCover = (derection) => {
    if (!isTab) {
      // > 1024
      if (derection == "up") {
        // if (currentCover == 1) {
        //   return;
        // } else {
        //   coverContainer = document.querySelector(".cover-container");
        //   coverContainer.classList.remove("cover-down");
        //   coverContainer.classList.add("cover-up");
        //   currentCover = 1;
        // }
      } else if (derection == "down") {
        // if (currentCover == 2) {
        //   myContainer = document.querySelector(".my_container");
        //   myContainer.classList.remove("is-cover");
        //   myContainer.classList.add("is-content");
        //   isCover = false;
        //   resetAos();
        // } else {
        //   coverContainer = document.querySelector(".cover-container");
        //   coverContainer.classList.remove("cover-up");
        //   coverContainer.classList.add("cover-down");
        //   currentCover = 2;
        // }

        myContainer = document.querySelector(".my_container");
        myContainer.classList.remove("is-cover");
        myContainer.classList.add("is-content");
        isCover = false;
        resetAos();
      }
    } else {
      isBottomCover();
    }
  };

  //Kieemr tra duoi man hinh 1024 thi moi nhu nay

  // Ngay hàm dưới tiến hành check khi scroll xuống cuối mới chạy changeCover

  isCover = true;
  canScroll = true;

  function handleMouseWheel(event) {
    if (event.deltaY > 0) {
      // Scrolling down
      if (canScroll) {
        console.log("Mouse wheel scrolled down");

        canScroll = false;
        //logic here
        if (isCover) {
          changeCover("down");
        } else {
          // changePage("down");
        }

        setTimeout(() => {
          canScroll = true;
        }, 500);
      }
    } else {
      // Scrolling up
      if (canScroll) {
        console.log("Mouse wheel scrolled up");
        canScroll = false;
        //logic here

        if (isCover) {
          changeCover("up");
        } else {
          // changePage("up");
        }

        setTimeout(() => {
          canScroll = true;
        }, 500);
      }
    }
  }

  // Attaching mouse wheel event listener to window
  window.addEventListener("wheel", handleMouseWheel);

  /// trên mobile well ko đc
  if (isMobile) {
    var lastScrollPosition = window.pageYOffset || document.documentElement.scrollTop;

    window.addEventListener("scroll", function () {
      var currentScrollPosition = window.pageYOffset || document.documentElement.scrollTop;

      if (currentScrollPosition > lastScrollPosition) {
        if (canScroll) {
          console.log("Mouse wheel scrolled down");

          canScroll = false;
          //logic here
          if (isCover) {
            changeCover("down");
          } else {
            // changePage("down");
          }

          setTimeout(() => {
            canScroll = true;
          }, 500);
        }
      } else if (currentScrollPosition < lastScrollPosition) {
        if (canScroll) {
          console.log("Mouse wheel scrolled up");
          canScroll = false;
          //logic here

          if (isCover) {
            changeCover("up");
          } else {
            // changePage("up");
          }

          setTimeout(() => {
            canScroll = true;
          }, 500);
        }
      }

      lastScrollPosition = currentScrollPosition;
    });
  }

  //scroll cover mlobile

  isReady = false;
  isChange = false;
  isBottomCover = () => {
    var scrollPosition = window.innerHeight + window.scrollY;
    var documentHeight = document.body.scrollHeight;
    if (scrollPosition >= documentHeight) {
      console.log("Đã scroll đến cuối cùng của màn hình");
      // Hiện nút

      if (!isReady) {
        isReady = true;
        console.log("ready");
      } else {
        if (!isChange) {
          console.log("chuyển");
          isChange = true;
          myContainer = document.querySelector(".my_container");
          myContainer.classList.remove("is-cover");
          myContainer.classList.add("is-content");
          isCover = false;

          //scroll
          var element = document.querySelector(".content-container");
          var offset = element.offsetTop;
          setTimeout(() => {
            resetAos();
          }, 0);
          window.scrollTo({
            top: offset,
            behavior: "smooth", // Cuộn mượt
          });
        }
      }
    } else {
      isReady = false;
      console.log("Chưa ready");
      //Ẩn nút
    }
  };

  //nav

  listNav = document.querySelectorAll(".nav-item");
  listNav.forEach((element) => {
    element.addEventListener("click", () => {
      changePage(event.currentTarget);
    });
  });

  //toHome
  document.querySelector(".to-home").addEventListener("click", () => {
    changeCover("up");
    setTimeout(() => {
      myContainer = document.querySelector(".my_container");
      myContainer.classList.add("is-cover");
      myContainer.classList.remove("is-content");
      isCover = true;
    }, 200);

    // resetAos();
  });

  setTimeout(() => {
    document.querySelector(".my_container").classList.add("un-hide");
  }, 200);

  var swiper = new Swiper(".mySwiper", {
    loop: true,
    spaceBetween: 5,
    slidesPerView: 3,
    freeMode: true,
    watchSlidesProgress: true,
    navigation: {
      nextEl: ".my-group-btn .swiper-button-next",
      prevEl: ".my-group-btn .swiper-button-prev",
    },
  });
  var swiper2 = new Swiper(".mySwiper2", {
    loop: true,
    spaceBetween: 10,
    navigation: {
      nextEl: ".page-4 .swiper-button-next",
      prevEl: ".page-4 .swiper-button-prev",
    },
    thumbs: {
      swiper: swiper,
    },
  });

  var swiper3 = new Swiper(".mySwiper3", {
    effect: "coverflow",
    grabCursor: true,
    centeredSlides: true,
    spaceBetween: 80,
    slidesPerView: 1,
    // loop: true,
    coverflowEffect: {
      rotate: 0,
      stretch: 0,
      depth: 150,
      modifier: 1,
      slideShadows: true,
    },
    navigation: {
      nextEl: ".page-1 .swiper-button-next",
      prevEl: ".page-1 .swiper-button-prev",
    },
    pagination: {
      el: ".page-1 .swiper-pagination",
      type: "fraction",
    },
    breakpoints: {
      1601: { spaceBetween: 80 },
      1599: {
        spaceBetween: 40,
      },
      1024: {},
      300: {},
    },
  });

  var swiper = new Swiper(".mySwiper4", {
    slidesPerView: 1,
    navigation: {
      nextEl: ".swiper-4-container .swiper-button-next",
      prevEl: ".swiper-4-container .swiper-button-prev",
    },
  });

  playVideo = () => {
    $("#modal-video").modal("show");
    // xử lí reload và play tại đây
    document.querySelector("video").play();
    console.log("PLAYYYY");
    // Video.initDOM(1);
    // setTimeout(() => {
    //   document.querySelector(".icon_blockvideo").click();
    // isPlayVideoVne = true;
    // }, 100);

    // Khi chuyen tab chay ham pause
    // Video.vodIns[394440].pause()

    // document.querySelector(".author").addEventListener("click", () => {
    //   document.querySelector(".icon_blockvideo").click();
    //   Video.vodIns[394440].pause();
    // });
  };
});

// write function convert string to number

// write function change background when click on button has id = "haha"
